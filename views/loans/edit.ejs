<!DOCTYPE html>
<html lang="es" class="h-full">

<head>
    <meta charset="UTF-8">
    <title>Editar Préstamo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body class="bg-emerald-50 flex min-h-screen w-screen">

    <!-- SIDEBAR -->
    <%- include('../plantillas/sidebar') %>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="flex flex-col flex-1 w-full min-h-screen">

            <!-- HEADER -->
            <%- include('../plantillas/header1') %>

                <!-- MAIN -->
                <main class="flex-1 p-4">
                    <div class="container">
                        <% if (messages && messages.error) { %>
                            <div class="alert alert-danger"><%- messages.error %></div>
                        <% } %>

                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h4 class="mb-0">✏️ Editar Préstamo</h4>
                            </div>
                            <div class="card-body">
                                <form action="/loans/update/<%= loan.id_loan %>" method="POST">
                                    <!-- Información del Usuario -->
                                    <div class="form-group">
                                        <label>Usuario:</label>
                                        <input type="text" class="form-control" value="<%= loan.user_name %>" disabled>
                                    </div>

                                    <!-- Información del Libro -->
                                    <div class="form-group">
                                        <label>Libro:</label>
                                        <input type="text" class="form-control" value="<%= loan.book_name %>" disabled>
                                    </div>

                                    <!-- Fecha de Préstamo -->
                                    <div class="form-group">
                                        <label>Fecha de Préstamo:</label>
                                        <input type="date" class="form-control" 
                                            value="<%= loan.loan_date.toISOString().split('T')[0] %>" disabled>
                                    </div>

                                    <!-- Fecha de Devolución -->
                                    <div class="form-group">
                                        <label>Fecha de Devolución:</label>
                                        <input type="date" name="return_due" class="form-control" required
                                            value="<%= new Date(loan.return_due).toISOString().split('T')[0] %>"
                                            min="<%= new Date().toISOString().split('T')[0] %>"
                                            <%= loan.returned ? 'disabled' : '' %>>
                                        <% if (!loan.returned) { %>
                                            <small class="text-muted">Puede actualizar la fecha de devolución si es necesario</small>
                                        <% } %>
                                    </div>

                                    <!-- Estado del Préstamo -->
                                    <div class="form-group">
                                        <label>Estado:</label>
                                        <div>
                                            <span class="badge badge-<%= loan.returned ? 'success' : 'warning' %> p-2">
                                                <%= loan.returned ? 'Devuelto' : 'Prestado' %>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mt-4">
                                        <% if (!loan.returned) { %>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save"></i> Actualizar
                                            </button>
                                        <% } %>
                                        <a href="/loans" class="btn btn-secondary">
                                            <i class="fas fa-arrow-left"></i> Volver
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </main>

                <!-- FOOTER -->
                <%- include('../plantillas/footer') %>
        </div>

        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/your-code.js" crossorigin="anonymous"></script>
</body>

</html>